<head>
    <meta charset="UTF-8">
    <title>game 1</title>
    <style>
    canvas{
        border:1px solid black;
    }
    </style>
    
</head>
<body>
    <canvas id="id-canvas" width="400" height="300"></canvas>
<script>
var log = console.log.bind(console)

var imageFromPath = function(path) {
    var img = new Image()
    img.src = path
    return img
}


var Paddle = function() {
    var image = imageFromPath('paddle.png')
    var o = {
        image:image,
        x: 100,
        y: 200,
        speed: 5,
    }
    var paddle = o
    o.moveLeft = function(){
        paddle.x-= paddle.speed
    }
    o.moveRight = function(){
        paddle.x+= paddle.speed
    }
    return o
}
var PaGame = function() {
    var g = {
        actions:{},
        keydowns:{},
    }
    var canvas = document.querySelector('#id-canvas')
    var context = canvas.getContext('2d')
    g.canvas = canvas
    g.context = context
    //events
    window.addEventListener('keydown', function(event){
        g.keydowns[event.key] = true
        })
    window.addEventListener('keyup', function(event){
        g.keydowns[event.key] = true
        })
    //
    g.registerAction = function(key,callback) {
        g.actions[key] = callback
    }
    //update 
    setInterval(function(){
        var actions = Object.key(g.actions)
        for (var i = 0; i < actions.length; i++){
            var key = actions[i]
            if (g.keydowns[key]){
                //如果按键被按下，调用注册的 action
                g.actions[key]()
              }

        }
        g.update()
        context.clearRect(0, 0, canvas.width, canvas.height)
        g.draw()
    },1000/30)
    return g
    
}
var _main = function() {
    var game = PaGame()
    var paddle = Paddle()

var leftDown = false
var rightDown = false

window.addEventListener('keydown',function(event){
    //log('keydown')
    var k = event.key
    if (k == 'a'){
        leftDown = true
    } else if (k == 'd'){
        rightDown = true
    }
})
window.addEventListener('keyup',function(event){
    //log('keyup')
    var k = event.key
    if (k == 'a'){
        leftDown = false
    } else if (k == 'd'){
        rightDown = false
    }

})
game.update = function() {
    if (leftDown){
        paddle.moveLeft()
    } else if(rightDown){
        paddle.moveRight()
    }
}
game.draw = function() {
    // draw
    game.context.drawImage(paddle.image, paddle.x, paddle.y)
}

}
_main()
</script>
</body>
</html>